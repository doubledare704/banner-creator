function popup(){this.active=!1,this.handler="",this.preview=!1,this.onload=!1,this.width_mini=184,this.height_mini=195,this.preview_in_main=!1,this.effects=!1,this.id=0;var a=[],b=document.createElement("canvas"),c=b.getContext("2d");this.add=function(b){a.push(b)},this.show=function(d,e,f,g){if(POP.id=HELPER.getRandomInt(0,999999999),1==this.active)return this.hide(),!1;this.active=!0,this.handler=e,void 0!=f&&(this.preview=f),void 0!=g&&(this.onload=g);var h="",i=HELPER.get_dimensions();if(popup=document.getElementById("popup"),popup.style.top="150px",popup.style.left=Math.round(i[0]/2)+"px",1==this.effects){for(var j,k=0;k<EFFECTS.FILTERS_LIST.length;k++)if(EFFECTS.FILTERS_LIST[k].name==GUI.last_menu){j=k;break}var l=j-1;l<0&&(l=0);var m=j+1;m>EFFECTS.FILTERS_LIST.length-1&&(m=EFFECTS.FILTERS_LIST.length-1),h+='<span style="float:right;">',h+='<input id="previous_filter" type="button" value="&lt;"> ',h+='<select id="effect_browser">',h+='<option class="trn" value="">--- Select effect ---</option>';for(var k=0;k<EFFECTS.FILTERS_LIST.length;k++){var n="";if(EFFECTS.FILTERS_LIST[k].name==GUI.last_menu)var n="selected";h+=" <option "+n+' value="'+k+'">'+EFFECTS.FILTERS_LIST[k].title+"</option>"}h+="</select>",h+=' <input id="next_filter" onclick="" type="button" value="&gt;"> ',h+="</span>"}h+='<h2 id="popup_drag" class="trn">'+d+"</h2>",this.preview!==!1&&0==this.preview_in_main&&(h+='<div style="margin-top:15px;margin-bottom:15px;">',h+='<canvas style="position:relative;float:left;margin-right:5px;border:1px solid #393939;" width="'+POP.width_mini+'" height="'+POP.height_mini+'" id="pop_pre"></canvas>',h+='<canvas style="position:relative;border:1px solid #393939;background-color:#ffffff;" width="'+POP.width_mini+'" height="'+POP.height_mini+'" id="pop_post"></canvas>',h+="</div>"),h+='<table style="width:99%;">';for(var k in a){var o=a[k];if(h+='<tr id="popup-tr-'+a[k].name+'">',"Error"!=d&&(h+='<td style="font-weight:bold;padding-right:3px;width:130px;" class="trn">'+o.title+"</td>"),void 0!=o.name){if(void 0!=o.values){var p="";if(void 0!=o.onchange&&(p=' onchange="'+o.onchange+';" '),o.values.length>10||"select"==o.type){""==p&&void 0!=f&&(p=' onchange="POP.view();" '),h+='<td colspan="2"><select '+p+' style="font-size:12px;" id="pop_data_'+o.name+'">';var q=0;for(var r in o.values){var s="";o.value==o.values[r]&&(s='selected="selected"'),void 0==o.value&&0==q&&(s='selected="selected"'),h+="<option "+s+' name="'+o.values[r]+'">'+o.values[r]+"</option>",q++}h+="</select></td>"}else{h+='<td colspan="2">',o.values.length>2&&(h+='<div class="group">');var q=0;for(var r in o.values){var t="";o.value==o.values[r]&&(t='checked="checked"'),void 0==o.value&&0==q&&(t='checked="checked"'),""==p&&void 0!=f&&(p=' onchange="POP.view();" '),h+='<input type="radio" '+p+" "+t+' name="'+o.name+'" id="pop_data_'+o.name+"_poptmp"+r+'" value="'+o.values[r]+'">',h+='<label style="margin-right:20px;" class="trn" for="pop_data_'+o.name+"_poptmp"+r+'">'+o.values[r]+"</label>",o.values.length>2&&(h+="<br />"),q++}o.values.length>2&&(h+="</div>"),h+="</td>"}}else if(void 0!=o.value){var u=1;if(void 0!=o.step&&(u=o.step),void 0!=o.range){var v="";this.preview!==!1&&(v="POP.view();"),h+='<td><input type="range" id="pop_data_'+o.name+'" value="'+o.value+'" min="'+o.range[0]+'" max="'+o.range[1]+'" step="'+u+'" " oninput="document.getElementById(\'pv'+k+"').innerHTML=Math.round(this.value*100)/100;"+v+'" /></td>',h+='<td style="padding-left:10px;width:50px;" id="pv'+k+'">'+o.value+"</td>"}else if("color"==o.type)h+='<td><input type="color" id="pop_data_'+o.name+'" value="'+o.value+'" /></td>';else if(void 0==o.placeholder&&(o.placeholder=""),"textarea"==o.type)h+='<td><textarea style="height:80px;" id="pop_data_'+o.name+'" placeholder="'+o.placeholder+'">'+o.value+"</textarea></td>";else{var w="text";void 0==o.placeholder||""==o.placeholder||isNaN(o.placeholder)||(w="number"),void 0!=o.value&&"number"==typeof o.value&&(w="number"),h+='<td colspan="2"><input type="'+w+'" id="pop_data_'+o.name+'" value="'+o.value+'" placeholder="'+o.placeholder+'" onkeyup="POP.validate(this);" /></td>'}}}else if(void 0!=o.function){var x;x="string"==typeof o.function?window[o.function]():o.function(),h+='<td colspan="3">'+x+"</td>"}else if(void 0!=o.html)h+='<td style="padding-bottom:3px;padding-top:3px;" colspan="2">'+o.html+"</td>";else{str=""+o.value;var y=o.title.toLowerCase().replace(/[^\w]+/g,"").replace(/ +/g,"-");y=y.substring(0,10),h+=str.length<40?'<td colspan="2"><div class="trn" id="pop_data_'+y+'" style="padding: 2px 0px;">'+o.value+"</div></td>":'<td style="font-size:11px;" colspan="2"><textarea disabled="disabled">'+o.value+"</textarea></td>"}h+="</tr>"}if(h+="</table>",h+='<div style="text-align:center;margin-top:20px;margin-bottom:15px;">',h+='<button onclick="POP.save();" class="button trn">Ok</button>',h+='<button onclick="POP.hide();" class="button trn">Cancel</button>',this.preview_in_main!==!1&&(h+='<button onclick="POP.view();" class="button trn">Preview</button>'),h+="</div>",document.getElementById("popup").innerHTML=h,document.getElementById("popup").style.display="block",a.length>15?document.getElementById("popup").style.overflowY="scroll":document.getElementById("popup").style.overflowY="hidden",""!=this.onload&&("string"==typeof this.onload?window[this.onload]():this.onload()),1==this.effects){document.getElementById("previous_filter").disabled=!1,document.getElementById("next_filter").disabled=!1,0==j&&(document.getElementById("previous_filter").disabled=!0),j==EFFECTS.FILTERS_LIST.length-1&&(document.getElementById("next_filter").disabled=!0),document.getElementById("previous_filter").addEventListener("click",function(a){POP.hide(),GUI.last_menu=EFFECTS.FILTERS_LIST[l].name,call_menu(EFFECTS,EFFECTS.FILTERS_LIST[l].name)}),document.getElementById("next_filter").addEventListener("click",function(a){POP.hide(),GUI.last_menu=EFFECTS.FILTERS_LIST[m].name,call_menu(EFFECTS,EFFECTS.FILTERS_LIST[m].name)});var z=document.getElementById("effect_browser");z.addEventListener("change",function(a){var b=z.options[z.selectedIndex].value;POP.hide(),GUI.last_menu=EFFECTS.FILTERS_LIST[b].name,call_menu(EFFECTS,EFFECTS.FILTERS_LIST[b].name)})}if(this.preview!==!1&&0==this.preview_in_main){var A=document.getElementById("pop_pre").getContext("2d");A.rect(0,0,POP.width_mini,POP.height_mini),A.fillStyle="#ffffff",A.fill(),GUI.draw_background(A,POP.width_mini,POP.height_mini,5),A.drawImage(document.getElementById(LAYER.layers[LAYER.layer_active].name),0,0,POP.width_mini,POP.height_mini),pop_post=document.getElementById("pop_post").getContext("2d"),pop_post.rect(0,0,POP.width_mini,POP.height_mini),pop_post.fillStyle="#ffffff",pop_post.fill(),GUI.draw_background(pop_post,POP.width_mini,POP.height_mini,5),pop_post.drawImage(document.getElementById(LAYER.layers[LAYER.layer_active].name),0,0,POP.width_mini,POP.height_mini),b.width=POP.width_mini,b.height=POP.height_mini,c.drawImage(document.getElementById(LAYER.layers[LAYER.layer_active].name),0,0,POP.width_mini,POP.height_mini),POP.view()}HELP.help_translate(LANG)},this.hide=function(){document.getElementById("popup").style.display="none",a=[],this.handler="",this.active=!1,this.preview=!1,this.onload=!1,this.preview_in_main=!1,this.effects=!1,canvas_front.clearRect(0,0,WIDTH,HEIGHT)},this.view=function(){if(this.preview!==!1){0==this.preview_in_main&&(pop_post.clearRect(0,0,POP.width_mini,POP.height_mini),pop_post.drawImage(b,0,0));var a={};for(inputs=document.getElementsByTagName("input"),i=0;i<inputs.length;i++)if("pop_data_"==inputs[i].id.substr(0,9)){var c=inputs[i].id.substr(9);0!=HELPER.strpos(c,"_poptmp")&&(c=c.substring(0,HELPER.strpos(c,"_poptmp")));var d=inputs[i].value;"radio"==inputs[i].type?1==inputs[i].checked&&(a[c]=d):a[c]=d}for(selects=document.getElementsByTagName("select"),i=0;i<selects.length;i++)if("pop_data_"==selects[i].id.substr(0,9)){var c=selects[i].id.substr(9),d=selects[i].value;a[c]=d}for(textareas=document.getElementsByTagName("textarea"),i=0;i<textareas.length;i++)if("pop_data_"==textareas[i].id.substr(0,9)){var c=textareas[i].id.substr(9),d=textareas[i].value;a[c]=d}0==this.preview_in_main?this.preview(a,pop_post,POP.width_mini,POP.height_mini):this.preview(a)}},this.save=function(){this.active=!1,document.getElementById("popup").style.display="none";var b={};for(inputs=document.getElementsByTagName("input"),i=0;i<inputs.length;i++)if("pop_data_"==inputs[i].id.substr(0,9)){var c=inputs[i].id.substr(9);0!=HELPER.strpos(c,"_poptmp")&&(c=c.substring(0,HELPER.strpos(c,"_poptmp")));var d=inputs[i].value;"radio"==inputs[i].type?1==inputs[i].checked&&(b[c]=d):b[c]=d}for(selects=document.getElementsByTagName("select"),i=0;i<selects.length;i++)if("pop_data_"==selects[i].id.substr(0,9)){var c=selects[i].id.substr(9),d=selects[i].value;b[c]=d}for(textareas=document.getElementsByTagName("textarea"),i=0;i<textareas.length;i++)if("pop_data_"==textareas[i].id.substr(0,9)){var c=textareas[i].id.substr(9),d=textareas[i].value;b[c]=d}a=[],this.preview=!1,this.onload=!1,this.preview_in_main=!1,this.effects=!1,""!=this.handler&&("object"==typeof this.handler?this.handler[0][this.handler[1]](b):"function"==typeof this.handler?this.handler(b):console.log("error: wrong function type: "+this.handler)),this.handler=""},this.validate=function(b){for(var c in a){var d=a[c];if("pop_data_"+d.name==b.id&&void 0!=d.range){if("-"==b.value||""==b.value)return!0;var e=parseFloat(b.value);(isNaN(e)||e!=b.value)&&(b.value=d.value),e<d.range[0]?b.value=d.range[0]:e>d.range[1]&&(b.value=d.range[1])}}}}var POP=new popup;