function TOOLS_CLASS(){this.tools_sprites=function(){POP.add({name:"param1",title:"Gap:",value:"50",values:["0","10","50","100"]}),POP.show("Sprites",function(a){EDIT.save_state();var b=parseInt(a.param1);TOOLS.generate_sprites(b)})},this.tools_keypoints=function(){SIFT.generate_keypoints(canvas_active(!0),!0)},this.tools_panorama=function(){SIFT.panorama()},this.tools_color2alpha=function(){POP.add({name:"param1",title:"Color:",value:COLOR,type:"color"}),POP.show("Color to alpha",function(a){EDIT.save_state();var b=a.param1;TOOLS.convert_color_to_alpha(canvas_active(),WIDTH,HEIGHT,b),GUI.zoom()},function(a,b,c,d){var e=a.param1;TOOLS.convert_color_to_alpha(b,c,d,e)})},this.tools_color_zoom=function(){POP.add({name:"param1",title:"Zoom:",value:"2",range:[2,20]}),POP.add({name:"param2",title:"Center:",value:"128",range:[0,255]}),POP.show("Color Zoom",function(a){EDIT.save_state();var b=parseInt(a.param1),c=parseInt(a.param2);TOOLS.color_zoom(canvas_active(),WIDTH,HEIGHT,b,c),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=parseInt(a.param2);TOOLS.color_zoom(b,c,d,e,f)})},this.tools_restore_alpha=function(){POP.add({name:"param",title:"Level:",value:"128",range:[0,255]}),POP.show("Recover alpha",function(a){EDIT.save_state();var b=parseInt(a.param);TOOLS.recover_alpha(canvas_active(),WIDTH,HEIGHT,b),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param);TOOLS.recover_alpha(b,c,d,e)})},this.tools_borders=function(){POP.add({name:"param1",title:"Color:",value:COLOR,type:"color"}),POP.add({name:"param2",title:"Size:",value:"5",range:[1,100]}),POP.show("Borders",function(a){EDIT.save_state();var b=a.param1,c=parseInt(a.param2);LAYER.add_layer(),TOOLS.add_borders(canvas_active(),WIDTH,HEIGHT,b,c),GUI.zoom()},function(a,b,c,d){var e=a.param1,f=parseInt(a.param2);TOOLS.add_borders(b,c,d,e,f)})},this.generate_sprites=function(a){if(1==LAYER.layers.length)return!1;EDIT.save_state(),LAYER.layer_add();var b=0,c=0,d=0,e=document.createElement("canvas");e.setAttribute("id","tmp_canvas"),e.width=WIDTH,e.height=HEIGHT;var f=WIDTH,g=HEIGHT;for(var h in LAYER.layers)if(h!=LAYER.layer_active&&0!=LAYER.layers[h].visible){e.getContext("2d").clearRect(0,0,f,g),e.getContext("2d").drawImage(document.getElementById(LAYER.layers[h].name),0,0);var i=IMAGE.trim_info(e,!1);if(WIDTH!=i.left){var j=f-i.left-i.right,k=g-i.top-i.bottom;b+j>WIDTH&&(b=0,c+=d,d=0),c%a>0&&a>0&&(c=c-c%a+a),c+k>HEIGHT&&(EVENTS.autosize=!1,HEIGHT=c+k,LAYER.set_canvas_size()),canvas_active().drawImage(e,i.left,i.top,j,k,b,c,j,k),b+=j,a>0&&(b=b-b%a+a),k>d&&(d=k),b>WIDTH&&(b=0,c+=d,d=0)}}},this.convert_color_to_alpha=function(a,b,c,d){for(var e=a.getImageData(0,0,b,c),f=e.data,g=HELPER.hex2rgb(d),h=0;h<f.length;h+=4)if(0!=f[h+3]){var i=Math.abs(f[h]-g.r)+Math.abs(f[h+1]-g.g)+Math.abs(f[h+2]-g.b)/3;f[h+3]=Math.round(i),f[h]=Math.ceil((f[h]-g.r*(1-f[h+3]/255))/(f[h+3]/255)),f[h+1]=Math.ceil((f[h+1]-g.g*(1-f[h+3]/255))/(f[h+3]/255)),f[h+2]=Math.ceil((f[h+2]-g.b*(1-f[h+3]/255))/(f[h+3]/255))}a.putImageData(e,0,0)},this.color_zoom=function(a,b,c,d,e){for(var h,f=a.getImageData(0,0,b,c),g=f.data,i=0;i<g.length;i+=4)if(0!=g[i+3]){h=Math.round(.2126*g[i]+.7152*g[i+1]+.0722*g[i+2]);for(var j=0;j<3;j++){var k=i+j;h>e?g[k]+=(g[k]-e)*d:h<e&&(g[k]-=(e-g[k])*d),g[k]<0&&(g[k]=0),g[k]>255&&(g[k]=255)}}a.putImageData(f,0,0)},this.recover_alpha=function(a,b,c,d){var g,e=a.getImageData(0,0,b,c),f=e.data;d=parseInt(d);for(var h=0;h<f.length;h+=4)g=f[h+3]+d,g>255&&(g=255),f[h+3]=g;a.putImageData(e,0,0)},this.add_borders=function(a,b,c,d,e){a.strokeStyle=d,a.lineWidth=e,EL.rectangle(a,0,0,b-1,c-1,!1,!0)}}var TOOLS=new TOOLS_CLASS;