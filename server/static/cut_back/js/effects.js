function EFFECTS_CLASS(){this.FILTERS_LIST=[{title:"Black and White",name:"effects_bw"},{title:"Blur-Box",name:"effects_BoxBlur"},{title:"Blur-Gaussian",name:"effects_GaussianBlur"},{title:"Blur-Stack",name:"effects_StackBlur"},{title:"Blur-Zoom",name:"effects_zoomblur"},{title:"Bulge/Pinch",name:"effects_bulge_pinch"},{title:"Colorize",name:"effects_colorize"},{title:"Denoise",name:"effects_denoise"},{title:"Desaturate",name:"effects_Desaturate"},{title:"Dither",name:"effects_Dither"},{title:"Dot Screen",name:"effects_dot_screen"},{title:"Edge",name:"effects_Edge"},{title:"Emboss",name:"effects_Emboss"},{title:"Enrich",name:"effects_Enrich"},{title:"Gamma",name:"effects_Gamma"},{title:"Grains",name:"effects_Grains"},{title:"Heatmap",name:"effects_heatmap"},{title:"HSL Adjustment",name:"effects_HSLAdjustment"},{title:"JPG Compression",name:"effects_jpg_vintage"},{title:"Mosaic",name:"effects_Mosaic"},{title:"Oil",name:"effects_Oil"},{title:"Posterize",name:"effects_Posterize"},{title:"Sepia",name:"effects_Sepia"},{title:"Sharpen",name:"effects_Sharpen"},{title:"Solarize",name:"effects_Solarize"},{title:"Tilt Shift",name:"effects_tilt_shift"},{title:"Vignette",name:"effects_vignette"},{title:"Vintage",name:"effects_vintage"}];var a=!1;this.load_fx=function(){0==a&&(a=fx.canvas())},this.effects_bw=function(){var a=this.thresholding("otsu",canvas_active(),WIDTH,HEIGHT,!0);POP.add({name:"param1",title:"Level:",value:a,range:[0,255]}),POP.add({name:"param2",title:"Dithering:",values:["No","Yes"],onchange:"EFFECTS.effects_bw_onchange()"}),POP.effects=!0,POP.show("Black and White",function(a){EDIT.save_state();var b=parseInt(a.param1),c=!1;"Yes"==a.param2&&(c=!0),EFFECTS.effect_bw(canvas_active(),WIDTH,HEIGHT,b,c),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=!1;"Yes"==a.param2&&(f=!0),EFFECTS.effect_bw(b,c,d,e,f)})},this.effects_bw_onchange=function(){var a=document.getElementById("pop_data_param1"),b=document.getElementById("pop_data_param2_poptmp0"),c=document.getElementById("pop_data_param2_poptmp1");1==b.checked?a.disabled=!1:1==c.checked&&(a.disabled=!0),POP.view()},this.effects_BoxBlur=function(){POP.add({name:"param1",title:"H Radius:",value:"3",range:[1,20]}),POP.add({name:"param2",title:"V Radius:",value:"3",range:[1,20]}),POP.add({name:"param3",title:"Quality:",value:"2",range:[1,10]}),POP.effects=!0,POP.show("Blur-Box",function(a){EDIT.save_state();var b=parseInt(a.param1),c=parseInt(a.param2),d=parseInt(a.param3),e=canvas_active().getImageData(0,0,WIDTH,HEIGHT),f=ImageFilters.BoxBlur(e,b,c,d);canvas_active().putImageData(f,0,0),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=parseInt(a.param2),g=parseInt(a.param3),h=b.getImageData(0,0,c,d),i=ImageFilters.BoxBlur(h,e,f,g);b.putImageData(i,0,0)})},this.effects_GaussianBlur=function(){POP.add({name:"param1",title:"Strength:",value:"2",range:[1,4],step:.1}),POP.effects=!0,POP.show("Blur-Gaussian",function(a){EDIT.save_state();var b=parseFloat(a.param1),c=canvas_active().getImageData(0,0,WIDTH,HEIGHT),d=ImageFilters.GaussianBlur(c,b);canvas_active().putImageData(d,0,0),GUI.zoom()},function(a,b,c,d){var e=parseFloat(a.param1),f=b.getImageData(0,0,c,d),g=ImageFilters.GaussianBlur(f,e);b.putImageData(g,0,0)})},this.effects_StackBlur=function(){POP.add({name:"param1",title:"Radius:",value:"6",range:[1,40]}),POP.effects=!0,POP.show("Blur-Stack",function(a){EDIT.save_state();var b=parseInt(a.param1),c=canvas_active().getImageData(0,0,WIDTH,HEIGHT),d=ImageFilters.StackBlur(c,b);canvas_active().putImageData(d,0,0),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=b.getImageData(0,0,c,d),g=ImageFilters.StackBlur(f,e);b.putImageData(g,0,0)})},this.effects_zoomblur=function(){this.load_fx(),POP.add({name:"param1",title:"Strength:",value:"0.3",range:[0,1],step:.01}),POP.add({name:"param2",title:"Center x:",value:Math.round(WIDTH/2),range:[0,WIDTH]}),POP.add({name:"param3",title:"Center y:",value:Math.round(HEIGHT/2),range:[0,HEIGHT]}),POP.effects=!0,POP.show("Blur-Zoom",function(b){EDIT.save_state();var c=parseFloat(b.param1),d=parseInt(b.param2),e=parseInt(b.param3),f=a.texture(canvas_active(!0));a.draw(f).zoomBlur(d,e,c).update(),canvas_active().clearRect(0,0,WIDTH,HEIGHT),canvas_active().drawImage(a,0,0),GUI.zoom()},function(b,c,d,e){var f=parseFloat(b.param1),g=parseInt(b.param2),h=parseInt(b.param3);g=g/WIDTH*d,h=h/HEIGHT*e;var i=a.texture(c.getImageData(0,0,d,e));a.draw(i).zoomBlur(g,h,f).update(),c.drawImage(a,0,0),c.beginPath(),c.strokeStyle="#ff0000",c.lineWidth=1,c.beginPath(),c.arc(g,h,5,0,2*Math.PI,!0),c.stroke()})},this.effects_bulge_pinch=function(){this.load_fx(),POP.add({name:"param1",title:"Strength:",value:1,range:[-1,1],step:.1});var b=Math.min(WIDTH,HEIGHT);b=Math.round(b/2),POP.add({name:"param2",title:"Radius:",value:b,range:[0,600]}),POP.effects=!0,POP.show("Bulge/Pinch",function(b){EDIT.save_state();var c=parseFloat(b.param1),d=parseInt(b.param2),e=a.texture(canvas_active(!0));a.draw(e).bulgePinch(Math.round(WIDTH/2),Math.round(HEIGHT/2),d,c).update(),canvas_active().clearRect(0,0,WIDTH,HEIGHT),canvas_active().drawImage(a,0,0),GUI.zoom()},function(b,c,d,e){var f=parseFloat(b.param1),g=parseInt(b.param2);g=g/Math.min(WIDTH,HEIGHT)*Math.min(d,e);var h=a.texture(c.getImageData(0,0,d,e));a.draw(h).bulgePinch(Math.round(d/2),Math.round(e/2),g,f).update(),c.drawImage(a,0,0)})},this.effects_colorize=function(){var b,a=this;POP.add({name:"param1",title:"Power:",value:"3",range:[1,10]}),POP.add({name:"param2",title:"Limit:",value:"30",range:[10,200]}),POP.add({name:"param3",title:"Dithering:",values:["Yes","No"]}),POP.preview_in_main=!0,POP.effects=!0,POP.show("Auto colorize",function(c){EDIT.save_state();var d=parseInt(c.param1),e=parseInt(c.param2);"Yes"==c.param3?param3=!0:param3=!1,a.colorize(canvas_active(),WIDTH,HEIGHT,d,e,param3,b),GUI.zoom(),canvas_front.clearRect(0,0,WIDTH,HEIGHT)},function(c){POP.preview_in_main=!0;var d=parseInt(c.param1),e=parseInt(c.param2);"Yes"==c.param3?param3=!0:param3=!1,b=a.colorize(!1,WIDTH,HEIGHT,d,e,param3,!0),canvas_front.clearRect(0,0,WIDTH,HEIGHT),canvas_front.drawImage(canvas_active(!0),0,0),a.colorize(canvas_front,WIDTH,HEIGHT,d,e,param3,b)})},this.effects_denoise=function(){this.load_fx(),POP.add({name:"param1",title:"Exponent:",value:"20",range:[0,50]}),POP.effects=!0,POP.show("Denoise",function(b){EDIT.save_state();var c=parseFloat(b.param1),d=a.texture(canvas_active(!0));a.draw(d).denoise(c).update(),canvas_active().clearRect(0,0,WIDTH,HEIGHT),canvas_active().drawImage(a,0,0),GUI.zoom()},function(b,c,d,e){var f=parseFloat(b.param1),g=a.texture(c.getImageData(0,0,d,e));a.draw(g).denoise(f).update(),c.drawImage(a,0,0)})},this.effects_Desaturate=function(){POP.effects=!0,POP.show("Desaturate",function(a){EDIT.save_state();var b=canvas_active().getImageData(0,0,WIDTH,HEIGHT),c=ImageFilters.Desaturate(b);canvas_active().putImageData(c,0,0),GUI.zoom()},function(a,b,c,d){var e=b.getImageData(0,0,c,d),f=ImageFilters.Desaturate(e);b.putImageData(f,0,0)})},this.effects_Dither=function(){POP.add({name:"param1",title:"Levels:",value:"8",range:[2,32]}),POP.effects=!0,POP.show("Dither",function(a){EDIT.save_state();var b=parseInt(a.param1),c=canvas_active().getImageData(0,0,WIDTH,HEIGHT),d=ImageFilters.Dither(c,b);canvas_active().putImageData(d,0,0),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=b.getImageData(0,0,c,d),g=ImageFilters.Dither(f,e);b.putImageData(g,0,0)})},this.effects_dot_screen=function(){this.load_fx(),POP.add({name:"param2",title:"Size:",value:"3",range:[1,20]}),POP.effects=!0,POP.show("Dot Screen",function(b){EDIT.save_state();var c=parseInt(b.param2),d=a.texture(canvas_active(!0));a.draw(d).dotScreen(Math.round(WIDTH/2),Math.round(HEIGHT/2),0,c).update(),canvas_active().clearRect(0,0,WIDTH,HEIGHT),canvas_active().drawImage(a,0,0),GUI.zoom()},function(b,c,d,e){var f=parseInt(b.param2),g=a.texture(c.getImageData(0,0,d,e));a.draw(g).dotScreen(Math.round(d/2),Math.round(e/2),0,f).update(),c.drawImage(a,0,0)})},this.effects_Edge=function(){POP.effects=!0,POP.show("Edge",function(a){EDIT.save_state();var b=canvas_active().getImageData(0,0,WIDTH,HEIGHT),c=ImageFilters.Edge(b);canvas_active().putImageData(c,0,0),GUI.zoom()},function(a,b,c,d){var e=b.getImageData(0,0,c,d),f=ImageFilters.Edge(e);b.putImageData(f,0,0)})},this.effects_Emboss=function(){POP.effects=!0,POP.show("Emboss",function(a){EDIT.save_state();var b=canvas_active().getImageData(0,0,WIDTH,HEIGHT),c=ImageFilters.Emboss(b);canvas_active().putImageData(c,0,0),GUI.zoom()},function(a,b,c,d){var e=b.getImageData(0,0,c,d),f=ImageFilters.Emboss(e);b.putImageData(f,0,0)})},this.effects_Enrich=function(){POP.effects=!0,POP.show("Enrich",function(a){EDIT.save_state();var b=canvas_active().getImageData(0,0,WIDTH,HEIGHT),c=ImageFilters.Enrich(b);canvas_active().putImageData(c,0,0),GUI.zoom()},function(a,b,c,d){var e=b.getImageData(0,0,c,d),f=ImageFilters.Enrich(e);b.putImageData(f,0,0)})},this.effects_Gamma=function(){POP.add({name:"param1",title:"Gamma:",value:"1",range:[0,3],step:.1}),POP.effects=!0,POP.show("Gamma",function(a){EDIT.save_state();var b=parseFloat(a.param1),c=canvas_active().getImageData(0,0,WIDTH,HEIGHT),d=ImageFilters.Gamma(c,b);canvas_active().putImageData(d,0,0),GUI.zoom()},function(a,b,c,d){var e=parseFloat(a.param1),f=b.getImageData(0,0,c,d),g=ImageFilters.Gamma(f,e);b.putImageData(g,0,0)})},this.effects_Grains=function(){var a=this;POP.effects=!0,POP.add({name:"param1",title:"Level:",value:"30",range:[0,50]}),POP.show("Grains",function(b){var c=parseInt(b.param1);EDIT.save_state(),a.grains_effect(canvas_active(),WIDTH,HEIGHT,c)},function(b,c,d,e){var f=parseInt(b.param1);a.grains_effect(c,d,e,f)})},this.effects_heatmap=function(){var a=this;POP.effects=!0,POP.show("Heatmap",function(b){EDIT.save_state(),a.heatmap_effect(canvas_active(),WIDTH,HEIGHT)},function(b,c,d,e){a.heatmap_effect(c,d,e)})},this.effects_HSLAdjustment=function(){POP.add({name:"param1",title:"Hue:",value:"0",range:[-180,180]}),POP.add({name:"param2",title:"Saturation:",value:"0",range:[-100,100]}),POP.add({name:"param3",title:"Luminance:",value:"0",range:[-100,100]}),POP.effects=!0,POP.show("HSL Adjustment",function(a){EDIT.save_state();var b=parseInt(a.param1),c=parseInt(a.param2),d=parseInt(a.param3),e=canvas_active().getImageData(0,0,WIDTH,HEIGHT),f=ImageFilters.HSLAdjustment(e,b,c,d);canvas_active().putImageData(f,0,0),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=parseInt(a.param2),g=parseInt(a.param3),h=b.getImageData(0,0,c,d),i=ImageFilters.HSLAdjustment(h,e,f,g);b.putImageData(i,0,0)})},this.effects_jpg_vintage=function(){POP.add({name:"param1",title:"Quality:",value:80,range:[1,100]}),POP.effects=!0,POP.show("JPG Compression",function(a){EDIT.save_state();var b=parseInt(a.param1);(b>100||b<1||1==isNaN(b))&&(b=80),b/=100;var c=canvas_active(!0).toDataURL("image/jpeg",b),d=new Image;d.onload=function(){canvas_active().clearRect(0,0,WIDTH,HEIGHT),canvas_active().drawImage(d,0,0)},d.src=c,GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1);(e>100||e<1||1==isNaN(e))&&(e=80),e/=100;var f=document.getElementById("pop_post"),g=f.toDataURL("image/jpeg",e),h=new Image;h.onload=function(){b.clearRect(0,0,c,d),b.drawImage(h,0,0)},h.src=g})},this.effects_Mosaic=function(){POP.add({name:"param1",title:"Size:",value:"10",range:[1,100]}),POP.effects=!0,POP.show("Mosaic",function(a){EDIT.save_state();var b=parseInt(a.param1),c=canvas_active().getImageData(0,0,WIDTH,HEIGHT),d=ImageFilters.Mosaic(c,b);canvas_active().putImageData(d,0,0),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=b.getImageData(0,0,c,d),g=ImageFilters.Mosaic(f,e);b.putImageData(g,0,0)})},this.effects_Oil=function(){POP.add({name:"param1",title:"Range:",value:"2",range:[1,5]}),POP.add({name:"param2",title:"Levels:",value:"32",range:[1,256]}),POP.effects=!0,POP.show("Oil",function(a){EDIT.save_state();var b=parseInt(a.param1),c=parseInt(a.param2),d=canvas_active().getImageData(0,0,WIDTH,HEIGHT),e=ImageFilters.Oil(d,b,c);canvas_active().putImageData(e,0,0),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=parseInt(a.param2),g=b.getImageData(0,0,c,d),h=ImageFilters.Oil(g,e,f);b.putImageData(h,0,0)})},this.effects_perspective=function(){function b(a,b){canvas_front.beginPath(),canvas_front.rect(a-round(EVENTS.sr_size/2),b-round(EVENTS.sr_size/2),EVENTS.sr_size,EVENTS.sr_size),canvas_front.fillStyle="#0000c8",canvas_front.fill()}this.load_fx(),POP.add({name:"param1",title:"X1:",value:WIDTH/4,range:[0,WIDTH]}),POP.add({name:"param2",title:"Y1:",value:HEIGHT/4,range:[0,HEIGHT]}),POP.add({name:"param3",title:"X2:",value:3*WIDTH/4,range:[0,WIDTH]}),POP.add({name:"param4",title:"Y2:",value:HEIGHT/4,range:[0,HEIGHT]}),POP.add({name:"param5",title:"X3:",value:3*WIDTH/4,range:[0,WIDTH]}),POP.add({name:"param6",title:"Y3:",value:3*HEIGHT/4,range:[0,HEIGHT]}),POP.add({name:"param7",title:"X4:",value:WIDTH/4,range:[0,WIDTH]}),POP.add({name:"param8",title:"Y4:",value:3*HEIGHT/4,range:[0,HEIGHT]}),POP.preview_in_main=!0,POP.effects=!0,POP.show("Perspective",function(b){EDIT.save_state();var c=parseInt(b.param1),d=parseInt(b.param2),e=parseInt(b.param3),f=parseInt(b.param4),g=parseInt(b.param5),h=parseInt(b.param6),i=parseInt(b.param7),j=parseInt(b.param8),k=a.texture(canvas_active(!0));a.draw(k).perspective([WIDTH/4,HEIGHT/4,3*WIDTH/4,HEIGHT/4,3*WIDTH/4,3*HEIGHT/4,WIDTH/4,3*HEIGHT/4],[c,d,e,f,g,h,i,j]).update(),canvas_active().clearRect(0,0,WIDTH,HEIGHT),canvas_active().drawImage(a,0,0),GUI.zoom()},function(c){var d=parseInt(c.param1),e=parseInt(c.param2),f=parseInt(c.param3),g=parseInt(c.param4),h=parseInt(c.param5),i=parseInt(c.param6),j=parseInt(c.param7),k=parseInt(c.param8);canvas_front.rect(0,0,WIDTH,HEIGHT),canvas_front.fillStyle="#ffffff",canvas_front.fill();var l=a.texture(canvas_active(!0));a.draw(l).perspective([WIDTH/4,HEIGHT/4,3*WIDTH/4,HEIGHT/4,3*WIDTH/4,3*HEIGHT/4,WIDTH/4,3*HEIGHT/4],[d,e,f,g,h,i,j,k]).update(),canvas_front.drawImage(a,0,0),b(d,e),b(f,g),b(h,i),b(j,k)})},this.effects_Posterize=function(){POP.add({name:"param1",title:"Levels:",value:"8",range:[2,32]}),POP.effects=!0,POP.show("Posterize",function(a){EDIT.save_state();var b=parseInt(a.param1),c=canvas_active().getImageData(0,0,WIDTH,HEIGHT),d=ImageFilters.Posterize(c,b);canvas_active().putImageData(d,0,0),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.param1),f=b.getImageData(0,0,c,d),g=ImageFilters.Posterize(f,e);b.putImageData(g,0,0)})},this.effects_Sepia=function(){POP.effects=!0,POP.show("Sepia",function(a){EDIT.save_state();var b=canvas_active().getImageData(0,0,WIDTH,HEIGHT),c=ImageFilters.Sepia(b);canvas_active().putImageData(c,0,0)},function(a,b,c,d){var e=b.getImageData(0,0,c,d),f=ImageFilters.Sepia(e);b.putImageData(f,0,0)})},this.effects_Sharpen=function(){POP.add({name:"param1",title:"Factor:",value:"3",range:[1,10],step:.1}),POP.effects=!0,POP.show("Sharpen",function(a){EDIT.save_state();var b=parseFloat(a.param1),c=canvas_active().getImageData(0,0,WIDTH,HEIGHT),d=ImageFilters.Sharpen(c,b);canvas_active().putImageData(d,0,0),GUI.zoom()},function(a,b,c,d){var e=parseFloat(a.param1),f=b.getImageData(0,0,c,d),g=ImageFilters.Sharpen(f,e);b.putImageData(g,0,0)})},this.effects_Solarize=function(){POP.effects=!0,POP.show("Solarize",function(a){EDIT.save_state();var b=canvas_active().getImageData(0,0,WIDTH,HEIGHT),c=ImageFilters.Solarize(b);canvas_active().putImageData(c,0,0)},function(a,b,c,d){var e=b.getImageData(0,0,c,d),f=ImageFilters.Solarize(e);b.putImageData(f,0,0)})},this.effects_tilt_shift=function(){this.load_fx(),POP.add({name:"param7",title:"Saturation:",value:"3",range:[0,100]}),POP.add({name:"param8",title:"Sharpen:",value:"1",range:[1,10]}),POP.add({name:"param1",title:"Blur Radius:",value:"15",range:[0,50]}),POP.add({name:"param2",title:"Gradient Radius:",value:"200",range:[0,400]}),POP.add({name:"param3",title:"X start:",value:"0",range:[0,WIDTH]}),POP.add({name:"param4",title:"Y start:",value:Math.round(HEIGHT/2),range:[0,HEIGHT]}),POP.add({name:"param5",title:"X end:",value:WIDTH,range:[0,WIDTH]}),POP.add({name:"param6",title:"Y end:",value:Math.round(HEIGHT/2),range:[0,HEIGHT]}),POP.effects=!0,POP.show("Tilt Shift",function(b){EDIT.save_state();var c=parseInt(b.param1),d=parseInt(b.param2),e=parseInt(b.param3),f=parseInt(b.param4),g=parseInt(b.param5),h=parseInt(b.param6),i=parseInt(b.param7),j=parseInt(b.param8),k=a.texture(canvas_active(!0));a.draw(k).tiltShift(e,f,g,h,c,d).update(),canvas_active().clearRect(0,0,WIDTH,HEIGHT),canvas_active().drawImage(a,0,0);var l=canvas_active().getImageData(0,0,WIDTH,HEIGHT),m=ImageFilters.HSLAdjustment(l,0,i,0);canvas_active().putImageData(m,0,0);var l=canvas_active().getImageData(0,0,WIDTH,HEIGHT),m=ImageFilters.Sharpen(l,j);canvas_active().putImageData(m,0,0),GUI.zoom()},function(b,c,d,e){var f=parseInt(b.param1),g=parseInt(b.param2),h=parseInt(b.param3),i=parseInt(b.param4),j=parseInt(b.param5),k=parseInt(b.param6),l=parseInt(b.param7),m=parseInt(b.param8),h=h/WIDTH*d,i=i/HEIGHT*e,j=j/WIDTH*d,k=k/HEIGHT*e,n=a.texture(c.getImageData(0,0,d,e));a.draw(n).tiltShift(h,i,j,k,f,g).update(),c.drawImage(a,0,0);var o=c.getImageData(0,0,d,e),p=ImageFilters.HSLAdjustment(o,0,l,0);c.putImageData(p,0,0);var o=c.getImageData(0,0,d,e),p=ImageFilters.Sharpen(o,m);c.putImageData(p,0,0),c.beginPath(),c.strokeStyle="#ff0000",c.lineWidth=1,c.moveTo(h+.5,i+.5),c.lineTo(j+.5,k+.5),c.stroke()})},this.effects_vignette=function(){this.load_fx(),POP.add({name:"param1",title:"Size:",value:"0.5",range:[0,1],step:.01}),POP.add({name:"param2",title:"Amount:",value:"0.5",range:[0,1],step:.01}),POP.effects=!0,POP.show("Vignette",function(b){EDIT.save_state();var c=parseFloat(b.param1),d=parseFloat(b.param2),e=a.texture(canvas_active(!0));a.draw(e).vignette(c,d).update(),canvas_active().clearRect(0,0,WIDTH,HEIGHT),canvas_active().drawImage(a,0,0),GUI.zoom()},function(b,c,d,e){var f=parseFloat(b.param1),g=parseFloat(b.param2),h=a.texture(c.getImageData(0,0,d,e));a.draw(h).vignette(f,g).update(),c.drawImage(a,0,0)})},this.effects_vintage=function(){POP.add({name:"red_offset",title:"Color adjust:",value:"70",range:[0,200]}),POP.add({name:"contrast",title:"Contrast:",value:"15",range:[0,50]}),POP.add({name:"blur",title:"Blur:",value:"0",range:[0,2],step:.1}),POP.add({name:"light_leak",title:"Light leak:",value:"90",range:[0,150]}),POP.add({name:"de_saturation",title:"Desaturation:",value:"40",range:[0,100]}),POP.add({name:"exposure",title:"Exposure level:",value:"80",range:[0,150]}),POP.add({name:"grains",title:"Grains level:",value:"20",range:[0,50]}),POP.add({name:"big_grains",title:"Big grains level:",value:"20",range:[0,50]}),POP.add({name:"vignette1",title:"Vignette size:",value:"0.3",range:[0,.5],step:.01}),POP.add({name:"vignette2",title:"Vignette amount:",value:"0.5",range:[0,.7],step:.01}),POP.add({name:"dust_level",title:"Dusts level:",value:"70",range:[0,100]}),POP.effects=!0,POP.show("Vintage",function(a){EDIT.save_state();var b=parseInt(a.red_offset),c=parseInt(a.contrast),d=parseFloat(a.blur),e=parseInt(a.light_leak),f=parseInt(a.de_saturation),g=parseInt(a.exposure),h=parseInt(a.grains),i=parseInt(a.big_grains),j=parseFloat(a.vignette1),k=parseFloat(a.vignette2),l=parseInt(a.dust_level);VINTAGE.adjust_color(canvas_active(),WIDTH,HEIGHT,b),VINTAGE.lower_contrast(canvas_active(),WIDTH,HEIGHT,c),VINTAGE.blur(canvas_active(),WIDTH,HEIGHT,d),VINTAGE.light_leak(canvas_active(),WIDTH,HEIGHT,e),VINTAGE.chemicals(canvas_active(),WIDTH,HEIGHT,f),VINTAGE.exposure(canvas_active(),WIDTH,HEIGHT,g),VINTAGE.grains(canvas_active(),WIDTH,HEIGHT,h),VINTAGE.grains_big(canvas_active(),WIDTH,HEIGHT,i),VINTAGE.optics(canvas_active(),WIDTH,HEIGHT,j,k),VINTAGE.dusts(canvas_active(),WIDTH,HEIGHT,l),GUI.zoom()},function(a,b,c,d){var e=parseInt(a.red_offset),f=parseInt(a.contrast),g=parseFloat(a.blur),h=parseInt(a.light_leak),i=parseInt(a.de_saturation),j=parseInt(a.exposure),k=parseInt(a.grains),l=parseInt(a.big_grains),m=parseFloat(a.vignette1),n=parseFloat(a.vignette2),o=parseInt(a.dust_level);VINTAGE.adjust_color(b,c,d,e),VINTAGE.lower_contrast(b,c,d,f),VINTAGE.blur(b,c,d,g),VINTAGE.light_leak(b,c,d,h),VINTAGE.chemicals(b,c,d,i),VINTAGE.exposure(b,c,d,j),VINTAGE.grains(b,c,d,k),VINTAGE.grains_big(b,c,d,l),VINTAGE.optics(b,c,d,m,n),VINTAGE.dusts(b,c,d,o)})},this.effect_bw=function(a,b,c,d,e){var h,i,j,k,f=a.getImageData(0,0,b,c),g=f.data;if(e!==!0)for(var l=0;l<g.length;l+=4)0!=g[l+3]&&(h=Math.round(.2126*g[l]+.7152*g[l+1]+.0722*g[l+2]),i=h<=d?0:255,g[l]=i,g[l+1]=i,g[l+2]=i);else{canvas_front.clearRect(0,0,b,c);for(var m=canvas_front.getImageData(0,0,b,c),n=m.data,o=0;o<c;o++)for(var l=0;l<b;l++){var p=o*(4*b)+4*l;0!=g[p+3]&&(h=Math.round(.2126*g[p]+.7152*g[p+1]+.0722*g[p+2]),h+=n[p],i=Math.floor(h/256),1==i&&(i=255),g[p]=i,g[p+1]=i,g[p+2]=i,j=h-i,l+1<b&&(k=p+4,n[k]+=Math.round(7*j/16)),l-1>0&&o+1<c&&(k=p-4+4*b,n[k]+=Math.round(3*j/16)),o+1<c&&(k=p+4*b,n[k]+=Math.round(5*j/16)),l+1<b&&o+1<c&&(k=p+4+4*b,n[k]+=Math.round(1*j/16)))}}a.putImageData(f,0,0)},this.colorize=function(a,b,c,d,e,f,g){if(void 0==g||g===!0){for(var h=[],i=0;i<3;i++){h[i]=[];for(var j=HELPER.getRandomInt(-1*d,d),k=0;k<=255;k++)h[i][k]=HELPER.getRandomInt(j-d,j+d),h[i][k]<-1*e?h[i][k]+=10:h[i][k]>e&&(h[i][k]-=10),j=h[i][k]}if(g===!0)return h}else var h=g;for(var l=a.getImageData(0,0,b,c),m=l.data,k=0;k<m.length;k+=4)if(0!=m[k+3]){if(1==f){var n=Math.abs(h[0][m[i]])+Math.abs(h[0][m[i]])+Math.abs(h[0][m[i]]);n/=3}for(var o=0;o<3;o++){var i=k+o;if(0==f)m[i]+=h[o][m[i]];else if(n<6*d)m[i]+=h[o][m[i]];else{var p=HELPER.getRandomInt(Math.min(0,h[o][m[i]]),Math.max(0,h[o][m[i]]));m[i]+=p}m[i]>255&&(m[i]=255),m[i]<0&&(m[i]=0)}}return a.putImageData(l,0,0),!1},this.heatmap_effect=function(a,b,c){for(var f,g,d=a.getImageData(0,0,b,c),e=d.data,h=0;h<e.length;h+=4)0!=e[h+3]&&(f=Math.round(.2126*e[h]+.7152*e[h+1]+.0722*e[h+2]),g=this.color2heat(f),e[h]=g.R,e[h+1]=g.G,e[h+2]=g.B);a.putImageData(d,0,0)},this.color2heat=function(a){var b={R:0,G:0,B:0};return a/=255,0<=a&&a<=1/8?(b.R=0,b.G=0,b.B=4*a+.5):1/8<a&&a<=3/8?(b.R=0,b.G=4*a-.5,b.B=1):3/8<a&&a<=5/8?(b.R=4*a-1.5,b.G=1,b.B=-4*a+2.5):5/8<a&&a<=7/8?(b.R=1,b.G=-4*a+3.5,b.B=0):7/8<a&&a<=1?(b.R=-4*a+4.5,b.G=0,b.B=0):(b.R=.5,b.G=0,b.B=0),b.R*=255,b.G*=255,b.B*=255,b.R=Math.round(b.R),b.G=Math.round(b.G),b.B=Math.round(b.B),b},this.thresholding=function(a,b,c,d,e){for(var i,f=b.getImageData(0,0,c,d),g=f.data,h=[],j=0;j<=255;j++)h[j]=0;for(var j=0;j<g.length;j+=4)i=Math.round(.2126*g[j]+.7152*g[j+1]+.0722*g[j+2]),h[i]++;var k;if("otsu"==a?k=this.otsu(h,c*d):alert("ERROR: unknown method in EFFECTS.thresholding()."),e===!0)return k;for(var l,j=0;j<g.length;j+=4)0!=g[j+3]&&(i=Math.round(.2126*g[j]+.7152*g[j+1]+.0722*g[j+2]),l=i<k?0:255,g[j]=l,g[j+1]=l,g[j+2]=l);b.putImageData(f,0,0)},this.otsu=function(a,b){for(var c=0,d=1;d<256;++d)c+=d*a[d];for(var e,f,g,h=0,i=0,j=0,k=0,l=0,d=0;d<256;++d)if(i+=a[d],0!=i){if(j=b-i,0==j)break;h+=d*a[d],e=h/i,f=(c-h)/j,g=i*j*Math.pow(e-f,2),g>k&&(k=g,l=d)}return l},this.grains_effect=function(a,b,c,d){if(0==d)return a;for(var e=a.getImageData(0,0,b,c),f=e.data,g=0;g<c;g++)for(var h=0;h<b;h++){var i=4*(h+g*b);if(0!=f[i+3]){var j=HELPER.getRandomInt(0,d);0!=j&&(f[i]-j<0?f[i]=-(f[i]-j):f[i]=f[i]-j,f[i+1]-j<0?f[i+1]=-(f[i+1]-j):f[i+1]=f[i+1]-j,f[i+2]-j<0?f[i+2]=-(f[i+2]-j):f[i+2]=f[i+2]-j)}}a.putImageData(e,0,0)}}var EFFECTS=new EFFECTS_CLASS;