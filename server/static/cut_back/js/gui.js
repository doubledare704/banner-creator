function GUI_CLASS(){this.PREVIEW_SIZE={w:148,h:100},this.last_menu="",this.grid_size=[50,50],this.grid=!1,this.TRANSPARENCY=!0,this.ZOOM=100,this.common_dimensions=[[640,480],[800,600],[1024,768],[1280,720],[1600,1200]];var a;this.draw_helpers=function(){var a="";for(var b in DRAW_TOOLS_CONFIG)a+='<a title="'+DRAW_TOOLS_CONFIG[b].title+'"',a+=" style=\"background: #989898 url('../static/cut_back/img/"+DRAW_TOOLS_CONFIG[b].icon[0]+"') no-repeat "+DRAW_TOOLS_CONFIG[b].icon[1]+"px "+DRAW_TOOLS_CONFIG[b].icon[2]+'px;"',a+=DRAW_TOOLS_CONFIG[b].name==DRAW.active_tool?' class="active trn"':' class="trn"',a+=" onclick=\"return GUI.action('"+DRAW_TOOLS_CONFIG[b].name+"');\"",a+=' id="'+DRAW_TOOLS_CONFIG[b].name+'"',a+=' href="#"></a>\n';document.getElementById("menu_left_container").innerHTML=a;var a=""},this.autodetect_dimensions=function(){for(var a=document.querySelector("#canvas_wrapper"),b=a.clientWidth,c=a.clientHeight,d=this.common_dimensions.length-1;d>=0;d--)if(!(this.common_dimensions[d][0]>b||this.common_dimensions[d][1]>c))return WIDTH=this.common_dimensions[d][0],void(HEIGHT=this.common_dimensions[d][1]);WIDTH=b-5,HEIGHT=c-10,b<585&&(HEIGHT-=15)},this.draw_background=function(a,b,c,d,e){if(0==this.TRANSPARENCY&&void 0==e)return a.beginPath(),a.rect(0,0,b,c),a.fillStyle="#ffffff",a.fill(),!1;void 0==d&&(d=10);for(var f=!0,g=0;g<b;g+=d){f=g%(2*d)==0;for(var h=0;h<c;h+=d)1==f?(a.fillStyle="#eeeeee",a.fillRect(g,h,d,d),f=!1):f=!0}},this.draw_grid=function(a,b){if(0==this.grid)return document.getElementById("canvas_grid").style.display="none",!1;document.getElementById("canvas_grid").style.display="",canvas_grid.clearRect(0,0,WIDTH,HEIGHT),void 0!=a&&void 0!=b?this.grid_size=[a,b]:(a=this.grid_size[0],b=this.grid_size[1]),a=parseInt(a),b=parseInt(b),a<2&&(a=2),b<2&&(b=2);for(var c=a;c<WIDTH&&0!=a;c+=a)c%(5*a)==0?(canvas_grid.strokeStyle="#222222",canvas_grid.beginPath(),canvas_grid.moveTo(.5+c,0),canvas_grid.lineTo(.5+c,HEIGHT),canvas_grid.stroke()):EL.line_dashed(canvas_grid,c,0,c,HEIGHT,3,"#888888");for(var c=b;c<HEIGHT&&0!=b;c+=b)c%(5*b)==0?(canvas_grid.strokeStyle="#222222",canvas_grid.beginPath(),canvas_grid.moveTo(0,.5+c),canvas_grid.lineTo(WIDTH,.5+c),canvas_grid.stroke()):EL.line_dashed(canvas_grid,0,c,WIDTH,c,3,"#888888")},this.redraw_preview=function(){canvas_preview.beginPath(),canvas_preview.rect(0,0,GUI.PREVIEW_SIZE.w,GUI.PREVIEW_SIZE.h),canvas_preview.fillStyle="#ffffff",canvas_preview.fill(),this.draw_background(canvas_preview,GUI.PREVIEW_SIZE.w,GUI.PREVIEW_SIZE.h,5),canvas_preview.save(),canvas_preview.scale(GUI.PREVIEW_SIZE.w/WIDTH,GUI.PREVIEW_SIZE.h/HEIGHT);for(var a in LAYER.layers)0!=LAYER.layers[a].visible&&canvas_preview.drawImage(document.getElementById(LAYER.layers[a].name),0,0,WIDTH,HEIGHT);return canvas_preview.restore(),z_x=EVENTS.ZOOM_POS[0],z_y=EVENTS.ZOOM_POS[1],z_x>GUI.PREVIEW_SIZE.w-EVENTS.mini_rect_data.w-1&&(z_x=GUI.PREVIEW_SIZE.w-EVENTS.mini_rect_data.w-1),z_y>GUI.PREVIEW_SIZE.h-EVENTS.mini_rect_data.h-1&&(z_y=GUI.PREVIEW_SIZE.h-EVENTS.mini_rect_data.h-1),canvas_preview.lineWidth=1,canvas_preview.beginPath(),canvas_preview.rect(Math.round(z_x)+.5,Math.round(z_y)+.5,EVENTS.mini_rect_data.w,EVENTS.mini_rect_data.h),canvas_preview.fillStyle="rgba(0, 0, 0, 0.2)",canvas_preview.strokeStyle="#393939",canvas_preview.fill(),canvas_preview.stroke(),!0},this.zoom=function(a,b){if(void 0!=a){if(1==a||a==-1){var c=100;this.ZOOM<=100&&a<0&&(c=10),this.ZOOM<100&&a>0&&(c=10),a*c+this.ZOOM>0&&(this.ZOOM=this.ZOOM+a*c,this.ZOOM>100&&this.ZOOM<200&&(this.ZOOM=100))}else this.ZOOM=parseInt(a);EVENTS.calc_preview_auto()}document.getElementById("zoom_nr").innerHTML=this.ZOOM,document.getElementById("zoom_range").value=this.ZOOM,document.getElementById("canvas_back").style.width=Math.round(WIDTH*this.ZOOM/100)+"px",document.getElementById("canvas_back").style.height=Math.round(HEIGHT*this.ZOOM/100)+"px";for(var d in LAYER.layers)document.getElementById(LAYER.layers[d].name).style.width=Math.round(WIDTH*this.ZOOM/100)+"px",document.getElementById(LAYER.layers[d].name).style.height=Math.round(HEIGHT*this.ZOOM/100)+"px";return document.getElementById("canvas_front").style.width=Math.round(WIDTH*this.ZOOM/100)+"px",document.getElementById("canvas_front").style.height=Math.round(HEIGHT*this.ZOOM/100)+"px",document.getElementById("canvas_grid").style.width=Math.round(WIDTH*this.ZOOM/100)+"px",document.getElementById("canvas_grid").style.height=Math.round(HEIGHT*this.ZOOM/100)+"px",100!=this.ZOOM?(document.getElementById("resize-w").style.display="none",document.getElementById("resize-h").style.display="none",document.getElementById("resize-wh").style.display="none"):(document.getElementById("resize-w").style.display="block",document.getElementById("resize-h").style.display="block",document.getElementById("resize-wh").style.display="block"),void 0!=b&&EVENTS.scroll_window(),this.redraw_preview(),!0},this.update_attribute=function(a,b){var c=500;for(var d in this.action_data().attributes)if(d==a.id){if(this.action_data().attributes[d]===!0||this.action_data().attributes[d]===!1){var e;e=0==b,this.action_data().attributes[d]=e,this.show_action_attributes()}else if("object"==typeof this.action_data().attributes[d]){var f=a.options[a.selectedIndex],e=f.getAttribute("data-value"),g=d.replace("_values","");this.action_data().attributes[g]=e}else if("#"==this.action_data().attributes[d][0]){var g=d.replace("_values","");this.action_data().attributes[g]=a.value}else{if(void 0!=b)b>0?0==parseInt(this.action_data().attributes[d])?a.value=1:1==parseInt(this.action_data().attributes[d])?a.value=5:5==parseInt(this.action_data().attributes[d])?a.value=10:a.value=parseInt(this.action_data().attributes[d])+b:b<0&&(1==parseInt(this.action_data().attributes[d])?a.value=0:parseInt(this.action_data().attributes[d])<=5?a.value=1:parseInt(this.action_data().attributes[d])<=10?a.value=5:parseInt(this.action_data().attributes[d])<=20?a.value=10:a.value=parseInt(this.action_data().attributes[d])+b),a.value<0&&(a.value=0),a.value>c&&(a.value=c);else{if(0==a.value.length)return!1;a.value=parseInt(a.value),a.value=Math.abs(a.value),(0==a.value||isNaN(a.value)||e>c)&&(a.value=this.action_data().attributes[d])}"power"==d&&a.value>100&&(a.value=100),this.action_data().attributes[d]=a.value,document.getElementById(d).value=a.value}void 0!=this.action_data().on_update&&DRAW[this.action_data().on_update](a.value)}if("erase"==DRAW.active_tool){var i=(this.action_data().attributes.strict,GUI.action_data().attributes.circle);0==i?document.getElementById("strict").style.display="none":document.getElementById("strict").style.display="block"}},this.action=function(a){return DRAW[a]("init",{valid:!0}),DRAW.active_tool!=a&&(""!=DRAW.active_tool&&(document.getElementById(DRAW.active_tool).className=""),DRAW.active_tool=a,document.getElementById(a).className="active trn",this.show_action_attributes(),!1)},this.action_data=function(){for(var a in DRAW_TOOLS_CONFIG)if(DRAW_TOOLS_CONFIG[a].name==DRAW.active_tool)return DRAW_TOOLS_CONFIG[a]},this.show_action_attributes=function(){html="";var a=10;for(var b in this.action_data().attributes){var c=b[0].toUpperCase()+b.slice(1);if(c=c.replace("_"," "),void 0==this.action_data().attributes[b+"_values"])if(this.action_data().attributes[b]===!0||this.action_data().attributes[b]===!1)1==this.action_data().attributes[b]?html+='<div onclick="GUI.update_attribute(this, 1)" style="background-color:#5680c1;" class="attribute-area trn" id="'+b+'">'+c+"</div>":html+='<div onclick="GUI.update_attribute(this, 0)" class="attribute-area trn" id="'+b+'">'+c+"</div>";else if("object"==typeof GUI.action_data().attributes[b]){html+='<select style="font-size:11px;margin-bottom:10px;" onchange="GUI.update_attribute(this);" id="'+b+'">';for(var d in GUI.action_data().attributes[b]){var e="",f=b.replace("_values","");GUI.action_data().attributes[f]==GUI.action_data().attributes[b][d]&&(e='selected="selected"'),html+='<option class="trn" '+e+' name="'+GUI.action_data().attributes[b][d]+'" data-value="'+GUI.action_data().attributes[b][d]+'">'+GUI.action_data().attributes[b][d]+"</option>"}html+="</select>"}else"#"==GUI.action_data().attributes[b][0]?(html+='<table style="width:100%;">',html+="<tr>",html+='<td style="font-weight:bold;width:45px;">'+c+":</td>",html+='<td><input onchange="GUI.update_attribute(this);" type="color" id="'+b+'" value="'+GUI.action_data().attributes[b]+'" /></td>',html+="</tr>",html+="</table>"):(html+='<div id="'+b+'_container">',html+='<table style="width:100%;">',html+="<tr>",html+='<td style="font-weight:bold;padding-right:2px;white-space:nowrap;" class="trn">'+c+":</td>",html+='<td><input onKeyUp="GUI.update_attribute(this);" type="number" id="'+b+'" value="'+GUI.action_data().attributes[b]+'" /></td>',html+="</tr>",html+="</table>",html+='<div style="float:left;width:32px;" onclick="GUI.update_attribute(this, '+a+')" class="attribute-area" id="'+b+'">+</div>',html+='<div style="margin-left:48px;margin-bottom:15px;" onclick="GUI.update_attribute(this, '+-a+')" class="attribute-area" id="'+b+'">-</div>',html+="</div>")}document.getElementById("action_attributes").innerHTML=html,HELP.help_translate(LANG)},this.set_color=function(b){1==HELPER.chech_input_color_support("main_color")&&"main_color"==b.id?COLOR=b.value:COLOR=HELPER.rgb2hex_all(b.style.backgroundColor),a=COLOR,1==HELPER.chech_input_color_support("main_color")?document.getElementById("main_color").value=COLOR:document.getElementById("main_color_alt").style.backgroundColor=COLOR,document.getElementById("color_hex").value=COLOR;var c=HELPER.hex2rgb(COLOR);document.getElementById("rgb_r").value=c.r,document.getElementById("rgb_g").value=c.g,document.getElementById("rgb_b").value=c.b},this.set_color_manual=function(a){var b=a.target;6==b.value.length&&"#"!=b.value[0]&&(COLOR="#"+b.value,this.sync_colors()),7==b.value.length?(COLOR=b.value,this.sync_colors()):b.value.length>7&&(b.value=COLOR)},this.set_color_rgb=function(a,b){var c=HELPER.hex2rgb(COLOR);if(a.value.length>3)a.value=c[b];else if(a.value.length>0){if(value=a.value,value=parseInt(value),isNaN(value)||value!=a.value||value>255||value<0)return a.value=c[b],!1;COLOR="#"+("000000"+HELPER.rgbToHex(document.getElementById("rgb_r").value,document.getElementById("rgb_g").value,document.getElementById("rgb_b").value)).slice(-6),ALPHA=document.getElementById("rgb_a").value,document.getElementById("rgb_a").value=ALPHA,this.sync_colors()}},this.sync_colors=function(){document.getElementById("color_hex").value=COLOR,1==HELPER.chech_input_color_support("main_color")?document.getElementById("main_color").value=COLOR:document.getElementById("main_color_alt").style.backgroundColor=COLOR;var a=HELPER.hex2rgb(COLOR);document.getElementById("rgb_r").value=a.r,document.getElementById("rgb_g").value=a.g,document.getElementById("rgb_b").value=a.b},this.toggle_color_select=function(){0==POP.active?(POP.add({title:"Color:",function:function(){a=COLOR;var b='<canvas style="position:relative;margin-bottom:5px;" id="c_all" width="300" height="300"></canvas>';return b+="<table>",b+="<tr>",b+="\t<td><b>Luminosity:</b></td>",b+='\t<td><input id="lum_ranger" oninput="GUI.change_lum(this.value);document.getElementById(\'lum_preview\').innerHTML=this.value;" type="range" value="0" min="-255" max="255" step="1"></td>',b+='\t<td style="padding-left:10px;width:30px;" id="lum_preview">0</td>',b+="</tr>",b+="<tr>",b+="\t<td><b>Alpha:</b></td>",b+='\t<td><input oninput="GUI.change_alpha(this.value);document.getElementById(\'alpha_preview\').innerHTML=this.value;" type="range" value="'+ALPHA+'" min="0" max="255" step="1"></td>',b+='\t<td style="padding-left:10px;" id="alpha_preview">'+ALPHA+"</td></tr>",b+="</tr>",b+="</table>"}}),POP.show("Select color",function(a){parseInt(a.param1)},void 0,this.toggle_color_select_onload)):POP.hide()},this.change_lum=function(b){b=parseInt(b);var c=HELPER.hex2rgb(a);c.r+=b,c.g+=b,c.b+=b,c.r<0&&(c.r=0),c.g<0&&(c.g=0),c.b<0&&(c.b=0),c.r>255&&(c.r=255),c.g>255&&(c.g=255),c.b>255&&(c.b=255),COLOR="#"+("000000"+HELPER.rgbToHex(c.r,c.g,c.b)).slice(-6),this.sync_colors()},this.change_alpha=function(a){ALPHA=parseInt(a),document.getElementById("rgb_a").value=ALPHA},this.toggle_color_select_onload=function(){var b=new Image;b.onload=function(){document.getElementById("c_all").getContext("2d").drawImage(b,0,0),document.getElementById("c_all").onmousedown=function(b){b.offsetX?(mouse_x=b.offsetX,mouse_y=b.offsetY):b.layerX&&(mouse_x=b.layerX,mouse_y=b.layerY);var c=document.getElementById("c_all").getContext("2d").getImageData(mouse_x,mouse_y,1,1).data;COLOR="#"+("000000"+HELPER.rgbToHex(c[0],c[1],c[2])).slice(-6),this.sync_colors(),a=COLOR,document.getElementById("lum_ranger").value=0}},b.src="img/colorwheel.png"},this.draw_selected_area=function(a){function f(a,b,c,d){var e=Math.ceil(EVENTS.sr_size/GUI.ZOOM*100);a=Math.round(a),b=Math.round(b),canvas_front.beginPath(),canvas_front.rect(a+c*Math.round(e),b+d*Math.round(e),e,e),canvas_front.fillStyle="#0000ff",canvas_front.fill()}if(0==DRAW.select_data)return!1;canvas_front.clearRect(0,0,WIDTH,HEIGHT);var b=DRAW.select_data.x,c=DRAW.select_data.y,d=DRAW.select_data.w,e=DRAW.select_data.h;return 100!=this.ZOOM&&(b=Math.round(b),c=Math.round(c),d=Math.round(d),e=Math.round(e)),canvas_front.fillStyle="rgba(0, 255, 0, 0.3)",canvas_front.fillRect(b,c,d,e),this.ZOOM<=100&&(canvas_front.strokeStyle="rgba(0, 255, 0, 1)",canvas_front.lineWidth=1,canvas_front.strokeRect(b+.5,c+.5,d,e)),1==a||(f(b,c,0,0),f(b+d,c,-1,0),f(b,c+e,0,-1),f(b+d,c+e,-1,-1),f(b+d/2,c,0,0),f(b,c+e/2,0,0),f(b+d/2,c+e,0,-1),void f(b+d,c+e/2,-1,0))},this.toggle=function(a){document.querySelector(a).classList.toggle("active")}}var GUI=new GUI_CLASS;